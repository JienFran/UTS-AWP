<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Semuabisa.com</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>

  <body class="bg-gray-50 font-sans min-h-screen flex flex-col">
    <header
      class="bg-blue-700 text-white px-4 sm:px-6 md:px-8 py-4 shadow-md"
    >
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center gap-3">
          <img src="logo.png" alt="Logo" class="h-8 sm:h-10 w-auto" />
          <h1 class="text-lg sm:text-xl font-semibold tracking-wide">
            Admin - Semuabisa.com
          </h1>
        </div>

        <nav class="order-last sm:order-none">
          <ul class="flex flex-wrap justify-center gap-4 sm:gap-6 md:gap-8 text-white font-medium text-sm sm:text-base">
            <li>
              <a href="#stats" class="hover:text-blue-300 transition duration-300"
                >Statistik</a
              >
            </li>
            <li>
              <a
                href="#campaign"
                class="hover:text-blue-300 transition duration-300"
                >Kampanye</a
              >
            </li>
            <li>
              <a
                href="#donator"
                class="hover:text-blue-300 transition duration-300"
                >Donatur</a
              >
            </li>
            <li>
              <a href="#print" class="hover:text-blue-300 transition duration-300"
                >Print</a
              >
            </li>
          </ul>
        </nav>

        <a
          href="/"
          class="bg-red-600 hover:bg-red-700 px-4 sm:px-5 py-2 rounded-lg font-medium transition-all duration-300 shadow-sm hover:shadow-md text-sm sm:text-base"
        >
          Sign Out
        </a>
      </div>
    </header>

   <main class="flex-grow max-w-6xl mx-auto mt-6 sm:mt-10 space-y-8 sm:space-y-12 px-3 sm:px-4">
      <section
        id="stats"
        class="bg-white p-4 sm:p-6 lg:p-8 rounded-xl sm:rounded-2xl shadow-md hover:shadow-lg transition-all duration-300"
      >
        <h2 class="text-2xl sm:text-3xl font-bold text-blue-700 text-center mb-6 sm:mb-8">
          Statistik Donasi
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
          <div
            class="bg-blue-50 p-4 sm:p-6 rounded-lg sm:rounded-xl shadow-sm hover:shadow-md text-center transition"
          >
            <h3 class="text-base sm:text-lg font-semibold text-gray-600">Total Donasi</h3>
            <p id="totalDonasi" class="text-2xl sm:text-3xl font-bold text-blue-700 mt-2">
              Loading...
            </p>
          </div>
          <div
            class="bg-blue-50 p-4 sm:p-6 rounded-lg sm:rounded-xl shadow-sm hover:shadow-md text-center transition"
          >
            <h3 class="text-base sm:text-lg font-semibold text-gray-600">Jumlah Donatur</h3>
            <p id="totalDonatur" class="text-2xl sm:text-3xl font-bold text-green-600 mt-2">
              Loading...
            </p>
          </div>
          <div
            class="bg-blue-50 p-4 sm:p-6 rounded-lg sm:rounded-xl shadow-sm hover:shadow-md text-center transition"
          >
            <h3 class="text-base sm:text-lg font-semibold text-gray-600">Total Kampanye</h3>
            <p id="totalKampanye" class="text-2xl sm:text-3xl font-bold text-blue-700 mt-2">
              Loading...
            </p>
          </div>
        </div>
      </section>

      <section
        id="campaign"
        class="bg-white p-4 sm:p-6 lg:p-8 rounded-xl sm:rounded-2xl shadow-md hover:shadow-lg transition-all duration-300"
      >
        <h2 class="text-xl sm:text-2xl font-semibold text-blue-700 mb-4 sm:mb-6 text-center">
          Kelola Kampanye Donasi
        </h2>

        <div class="flex flex-col gap-3 mb-4 sm:mb-6">
          <input
            id="searchCampaign"
            type="text"
            placeholder="Cari kampanye"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition text-sm sm:text-base"
          />

          <div class="flex flex-col sm:flex-row gap-3">
            <select
              id="sortCampaign"
              class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition text-sm sm:text-base"
            >
              <option value="">Urutkan berdasarkan</option>
              <option value="donasi">Donasi Tertinggi</option>
              <option value="target">Target Terbesar</option>
              <option value="tanggal">Kampanye Terbaru</option>
            </select>

            <div class="flex gap-2 sm:gap-3">
              <button
                id="btnCreateCampaign"
                class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base"
              >
                <i class="fas fa-plus mr-1 sm:mr-2"></i>
                <span class="hidden sm:inline">Tambah</span>
                <span class="sm:hidden">Baru</span>
              </button>

              <button
                id="btnCampaignSearch"
                type="button"
                class="flex-1 bg-blue-700 hover:bg-blue-800 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base"
              >
                <i class="fas fa-search mr-1 sm:mr-2"></i>
                <span class="hidden sm:inline">Cari</span>
                <span class="sm:hidden">Cari</span>
              </button>
            </div>
          </div>
        </div>

        <div class="overflow-x-auto rounded-lg border border-gray-200">
          <div class="min-w-full inline-block align-middle">
            <div class="overflow-hidden">
              <table class="min-w-full text-xs sm:text-sm border-collapse">
                <thead class="bg-blue-700 text-white">
                  <tr>
                    <th class="py-3 px-2 sm:px-4 border text-left">Nama</th>
                    <th class="py-3 px-2 sm:px-4 border hidden sm:table-cell">Terkumpul</th>
                    <th class="py-3 px-2 sm:px-4 border hidden md:table-cell">Target</th>
                    <th class="py-3 px-2 sm:px-4 border">Status</th>
                    <th class="py-3 px-2 sm:px-4 border hidden lg:table-cell">Berakhir</th>
                    <th class="py-3 px-2 sm:px-4 border">Aksi</th>
                  </tr>
                </thead>
                <tbody id="campaignTable" class="text-gray-700"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section
        id="donator"
        class="bg-white p-4 sm:p-6 lg:p-8 rounded-xl sm:rounded-2xl shadow-md hover:shadow-lg transition-all duration-300"
      >
        <h2 class="text-xl sm:text-2xl font-semibold text-blue-700 mb-4 sm:mb-6 text-center">
          Data Donasi
        </h2>

        <div class="flex flex-col sm:flex-row gap-3 mb-4 sm:mb-6">
          <input
            id="searchDonasi"
            type="text"
            placeholder="Cari nama donatur"
            class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition text-sm sm:text-base"
          />
          <button
            id="btnDonasiSearch"
            type="button"
            class="bg-blue-700 hover:bg-blue-800 text-white font-semibold px-4 sm:px-5 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base"
          >
            <i class="fas fa-search mr-1 sm:mr-2"></i>
            Cari
          </button>
        </div>

        <div class="overflow-x-auto rounded-lg border border-gray-200">
          <div class="min-w-full inline-block align-middle">
            <div class="overflow-hidden">
              <table class="min-w-full text-xs sm:text-sm border-collapse">
                <thead class="bg-blue-700 text-white">
                  <tr>
                    <th class="py-3 px-2 sm:px-4 border">ID</th>
                    <th class="py-3 px-2 sm:px-4 border">Nama</th>
                    <th class="py-3 px-2 sm:px-4 border">Nominal</th>
                    <th class="py-3 px-2 sm:px-4 border hidden sm:table-cell">Pesan</th>
                    <th class="py-3 px-2 sm:px-4 border hidden md:table-cell">Tanggal</th>
                    <th class="py-3 px-2 sm:px-4 border">Aksi</th>
                  </tr>
                </thead>
                <tbody id="donasiTable" class="text-gray-700"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section
        id="print"
        class="bg-white p-4 sm:p-6 lg:p-8 rounded-xl sm:rounded-2xl shadow-md hover:shadow-lg transition flex flex-col items-center gap-3 sm:gap-4"
      >
        <h2 class="text-xl sm:text-2xl font-semibold text-blue-700 mb-3 sm:mb-4 text-center">
          Print Data
        </h2>
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 w-full sm:w-auto">
          <button
            id="btnPrintCampaigns"
            class="bg-blue-700 hover:bg-blue-800 text-white font-semibold px-4 sm:px-5 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base flex items-center justify-center gap-2"
          >
            <i class="fas fa-print"></i>
            Kampanye
          </button>
          <button
            id="btnPrintDonasi"
            class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 sm:px-5 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base flex items-center justify-center gap-2"
          >
            <i class="fas fa-print"></i>
            Donatur
          </button>
        </div>
      </section>
    </main>

  <footer class="bg-blue-700 text-white text-center py-4 sm:py-6 mt-6 sm:mt-10 shadow-inner">
    <p class="text-sm sm:text-base">© 2025 <b>Semuabisa.com</b> — Bersama Kita Bisa</p>
  </footer>
  
    <div
      id="editModal"
      class="fixed inset-0 hidden bg-black/50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-xl shadow-xl p-4 sm:p-6 w-full max-w-md sm:max-w-lg border-t-4 border-blue-700 max-h-[90vh] overflow-y-auto"
      >
        <h3 class="text-lg sm:text-xl font-semibold text-blue-700 mb-4 text-center">
          Edit Kampanye
        </h3>
        <div class="space-y-3">
          <input
            id="editTitle"
            type="text"
            placeholder="Judul Kampanye"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <input
            id="editTarget"
            type="number"
            placeholder="Target Donasi"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <input
            id="editImageUrl"
            type="url"
            placeholder="Link Gambar (URL)"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <input
            id="editStatus"
            type="text"
            placeholder="Status (active/completed/cancelled)"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <input
            id="editEndDate"
            type="date"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button
            onclick="closeModal()"
            class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg text-sm sm:text-base"
          >
            Batal
          </button>
          <button
            id="btnUpdateCampaign"
            class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base"
          >
            Update
          </button>
        </div>
      </div>
    </div>

    <div
      id="createModal"
      class="fixed inset-0 hidden bg-black/50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-xl shadow-xl p-4 sm:p-6 w-full max-w-md sm:max-w-lg border-t-4 border-green-600 max-h-[90vh] overflow-y-auto"
      >
        <h3 class="text-lg sm:text-xl font-semibold text-blue-700 mb-4 text-center">
          Buat Kampanye Baru
        </h3>
        <div class="space-y-3">
          <input
            id="createTitle"
            type="text"
            placeholder="Judul Kampanye"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <textarea
            id="createDescription"
            placeholder="Deskripsi Kampanye"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
            rows="3"
          ></textarea>
          <input
            id="createImageUrl"
            type="url"
            placeholder="Link Gambar (URL)"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <input
            id="createTarget"
            type="number"
            placeholder="Target Donasi (Rp)"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
          <input
            id="createEndDate"
            type="date"
            class="w-full px-4 py-2 border rounded-lg text-sm sm:text-base"
          />
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button
            onclick="closeCreateModal()"
            class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg text-sm sm:text-base"
          >
            Batal
          </button>
          <button
            id="btnSaveCampaign"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base"
          >
            Simpan
          </button>
        </div>
      </div>
    </div>

    <div
      id="confirmModal"
      class="fixed inset-0 hidden bg-black/50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white p-4 sm:p-6 rounded-xl shadow-xl w-full max-w-sm sm:max-w-md text-center border-t-4 border-red-600"
      >
        <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-3">
          Konfirmasi Aksi
        </h3>
        <p id="confirmMessage" class="text-gray-600 mb-6 text-sm sm:text-base">
          Apakah Anda yakin ingin melanjutkan?
        </p>
        <div class="flex justify-center gap-3">
          <button
            id="cancelConfirm"
            class="bg-gray-300 hover:bg-gray-400 px-4 sm:px-5 py-2 rounded-lg text-sm sm:text-base"
          >
            Batal
          </button>
          <button
            id="confirmAction"
            class="bg-red-600 hover:bg-red-700 text-white px-4 sm:px-5 py-2 rounded-lg shadow-sm hover:shadow-md transition text-sm sm:text-base"
          >
            Ya, Hapus
          </button>
        </div>
      </div>
    </div>

    <script>
      const menuToggle = document.getElementById('menuToggle');
      const mobileMenu = document.getElementById('mobileMenu');
      const mainNav = document.getElementById('mainNav');
      
      menuToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        mainNav.classList.toggle('hidden');
        mainNav.classList.toggle('sm:block');
      });
      
      document.addEventListener('click', (event) => {
        if (!event.target.closest('#menuToggle') && !event.target.closest('#mobileMenu')) {
          mobileMenu.classList.add('hidden');
          mainNav.classList.add('hidden');
          mainNav.classList.add('sm:block');
        }
      });

      async function loadStats() {
        try {
          const [totalDonasiRes, jumlahDonaturRes, totalKampanyeRes] =
            await Promise.all([
              fetch("/api/stats/total-donasi"),
              fetch("/api/stats/jumlah-donatur"),
              fetch("/api/stats/total-kampanye"),
            ]);

          if (
            !totalDonasiRes.ok ||
            !jumlahDonaturRes.ok ||
            !totalKampanyeRes.ok
          ) {
            throw new Error("Gagal mengambil salah satu data statistik.");
          }

          const totalDonasiData = await totalDonasiRes.json();
          const jumlahDonaturData = await jumlahDonaturRes.json();
          const totalKampanyeData = await totalKampanyeRes.json();

          document.getElementById("totalDonasi").innerText = `Rp ${Number(
            totalDonasiData.totalDonasi
          ).toLocaleString("id-ID")}`;
          document.getElementById("totalDonatur").innerText =
            jumlahDonaturData.jumlahDonatur;
          document.getElementById("totalKampanye").innerText =
            totalKampanyeData.totalKampanye;
        } catch (err) {
          console.error("Gagal memuat statistik:", err);
          document.getElementById("totalDonasi").innerText = "Error";
          document.getElementById("totalDonatur").innerText = "Error";
          document.getElementById("totalKampanye").innerText = "Error";
        }
      }

      const confirmModal = document.getElementById("confirmModal");
      const confirmMessage = document.getElementById("confirmMessage");
      const confirmAction = document.getElementById("confirmAction");
      const cancelConfirm = document.getElementById("cancelConfirm");
      let onConfirm = null;

      function openConfirm(message, action) {
        confirmMessage.textContent = message;
        confirmModal.classList.remove("hidden");
        onConfirm = action;
      }

      cancelConfirm.addEventListener("click", () =>
        confirmModal.classList.add("hidden")
      );
      confirmAction.addEventListener("click", async () => {
        if (onConfirm) await onConfirm();
        confirmModal.classList.add("hidden");
        location.reload();
      });

      let selectedCampaignId = null;
      async function loadCampaigns() {
        const search = document.getElementById("searchCampaign").value.trim();
        const sort = document.getElementById("sortCampaign").value;
        const res = await fetch(
          `/api/campaigns?search=${encodeURIComponent(search)}&sort=${sort}`
        );
        const campaigns = await res.json();

        const tbody = document.getElementById("campaignTable");
        tbody.innerHTML = "";
        
        if (campaigns.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="border px-4 py-8 text-center text-gray-500">
                Tidak ada data kampanye
              </td>
            </tr>
          `;
          return;
        }
        
        campaigns.forEach((c) => {
          tbody.innerHTML += `
          <tr class="hover:bg-blue-50 transition">
            <td class="border px-2 sm:px-4 py-2 font-medium text-left">
              <div class="font-medium">${c.title}</div>
              <div class="text-xs text-gray-500 sm:hidden">
                Rp ${Number(c.current_amount).toLocaleString("id-ID")} / 
                Rp ${Number(c.target_amount).toLocaleString("id-ID")}
              </div>
            </td>
            <td class="border px-2 sm:px-4 py-2 text-blue-600 font-semibold hidden sm:table-cell">
              Rp ${Number(c.current_amount).toLocaleString("id-ID")}
            </td>
            <td class="border px-2 sm:px-4 py-2 hidden md:table-cell">
              Rp ${Number(c.target_amount).toLocaleString("id-ID")}
            </td>
            <td class="border px-2 sm:px-4 py-2 capitalize">
              <span class="px-2 py-1 rounded-full text-xs ${
                c.status === 'active' ? 'bg-green-100 text-green-800' :
                c.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                'bg-red-100 text-red-800'
              }">
                ${c.status}
              </span>
            </td>
            <td class="border px-2 sm:px-4 py-2 hidden lg:table-cell">
              ${new Date(c.end_date).toLocaleDateString("id-ID")}
            </td>
            <td class="border px-2 sm:px-4 py-2">
              <div class="flex flex-col sm:flex-row gap-1 sm:gap-2">
                <button onclick="openEditModal(${c.id}, '${c.title.replace(/'/g, "\\'")}', ${
            c.target_amount
          }, '${c.status}', '${
            c.end_date.split("T")[0]
          }', '${(c.image_url || '').replace(/'/g, "\\'")}')" 
                  class="bg-yellow-400 hover:bg-yellow-500 text-white px-2 sm:px-3 py-1 rounded text-xs sm:text-sm flex items-center justify-center gap-1">
                  <i class="fas fa-edit text-xs"></i>
                  <span class="hidden sm:inline">Edit</span>
                </button>
                <button onclick="openConfirm('Yakin ingin menghapus kampanye ini?', () => deleteCampaign(${
                c.id
              }))" 
                  class="bg-red-500 hover:bg-red-600 text-white px-2 sm:px-3 py-1 rounded text-xs sm:text-sm flex items-center justify-center gap-1">
                  <i class="fas fa-trash text-xs"></i>
                  <span class="hidden sm:inline">Hapus</span>
                </button>
              </div>
            </td>
          </tr>`;
        });
      }

      document
        .getElementById("btnCampaignSearch")
        .addEventListener("click", loadCampaigns);

      function openEditModal(id, title, target, status, endDate, imageUrl) {
        selectedCampaignId = id;
        document.getElementById("editTitle").value = title;
        document.getElementById("editTarget").value = target;
        document.getElementById("editImageUrl").value = imageUrl;
        document.getElementById("editStatus").value = status;
        document.getElementById("editEndDate").value = endDate;
        document.getElementById("editModal").classList.remove("hidden");
      }

      function closeModal() {
        document.getElementById("editModal").classList.add("hidden");
        selectedCampaignId = null;
      }

      document
        .getElementById("btnUpdateCampaign")
        .addEventListener("click", async () => {
          const updated = {
            title: document.getElementById("editTitle").value.trim(),
            target_amount: document.getElementById("editTarget").value,
            image_url: document.getElementById("editImageUrl").value.trim(),
            status: document.getElementById("editStatus").value.trim(),
            end_date: document.getElementById("editEndDate").value,
          };

          await fetch(`/api/campaigns/${selectedCampaignId}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updated),
          });
          closeModal();
          location.reload();
        });

      async function deleteCampaign(id) {
        await fetch(`/api/campaigns/${id}`, {
          method: "DELETE",
        });
      }

      const createModal = document.getElementById("createModal");
      document
        .getElementById("btnCreateCampaign")
        .addEventListener("click", () =>
          createModal.classList.remove("hidden")
        );

      function closeCreateModal() {
        createModal.classList.add("hidden");
      }

      document
        .getElementById("btnSaveCampaign")
        .addEventListener("click", async () => {
          const newCampaign = {
            title: document.getElementById("createTitle").value.trim(),
            description: document
              .getElementById("createDescription")
              .value.trim(),
            image_url: document.getElementById("createImageUrl").value.trim(),
            target_amount: document.getElementById("createTarget").value,
            end_date: document.getElementById("createEndDate").value,
          };

          await fetch("/api/campaigns", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newCampaign),
          });

          closeCreateModal();
          location.reload();
        });

      async function loadDonasi() {
        const search = document.getElementById("searchDonasi").value.trim();
        const res = await fetch(
          `/api/admin/donasi?search=${encodeURIComponent(search)}`
        );
        const data = await res.json();

        const tbody = document.getElementById("donasiTable");
        tbody.innerHTML = "";
        
        if (data.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="border px-4 py-8 text-center text-gray-500">
                Tidak ada data donasi
              </td>
            </tr>
          `;
          return;
        }
        
        data.forEach((d) => {
          tbody.innerHTML += `
          <tr class="hover:bg-gray-50 transition">
            <td class="border px-2 sm:px-4 py-2">${d.id}</td>
            <td class="border px-2 sm:px-4 py-2 font-medium">${d.nama_donatur}</td>
            <td class="border px-2 sm:px-4 py-2 text-blue-600 font-semibold">
              Rp ${Number(d.nominal).toLocaleString("id-ID")}
            </td>
            <td class="border px-2 sm:px-4 py-2 hidden sm:table-cell">
              <div class="max-w-xs truncate" title="${d.pesan || '-'}">
                ${d.pesan || "-"}
              </div>
            </td>
            <td class="border px-2 sm:px-4 py-2 hidden md:table-cell">
              ${new Date(d.tanggal).toLocaleDateString("id-ID")}
            </td>
            <td class="border px-2 sm:px-4 py-2">
              <button onclick="openConfirm('Yakin ingin menghapus donasi ini?', () => deleteDonasi(${
                d.id
              }))" 
                class="bg-red-500 hover:bg-red-600 text-white px-2 sm:px-3 py-1 rounded text-xs sm:text-sm flex items-center justify-center gap-1 w-full sm:w-auto">
                <i class="fas fa-trash text-xs"></i>
                <span class="hidden sm:inline">Hapus</span>
              </button>
            </td>
          </tr>`;
        });
      }

      document
        .getElementById("btnDonasiSearch")
        .addEventListener("click", loadDonasi);
        
      async function deleteDonasi(id) {
        await fetch(`/api/admin/donasi/${id}`, {
          method: "DELETE",
        });
      }

      document
        .getElementById("btnPrintCampaigns")
        .addEventListener("click", async () => {
          const res = await fetch("/api/campaigns");
          const campaigns = await res.json();

          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          doc.setFont("courier", "bold");
          doc.setFontSize(12);
          doc.text("Laporan Data Kampanye - Semuabisa.com", 14, 20);

          doc.setFont("courier", "normal");
          doc.setFontSize(11);

          let y = 35;
          const margin = 14;
          const pageWidth = doc.internal.pageSize.getWidth();
          const textWidth = pageWidth - margin * 2;

          campaigns.forEach((c, i) => {
            doc.text(`${i + 1}. ${c.title}`, margin, y);
            doc.text(
              `   Donasi: Rp ${Number(c.current_amount).toLocaleString(
                "id-ID"
              )}`,
              margin,
              y + 8
            );
            doc.text(
              `   Target: Rp ${Number(c.target_amount).toLocaleString(
                "id-ID"
              )}`,
              margin,
              y + 16
            );

            const descText = `   Deskripsi: ${c.description || "-"}`;
            const wrappedDesc = doc.splitTextToSize(descText, textWidth);
            doc.text(wrappedDesc, margin, y + 24);
            const descHeight = wrappedDesc.length * 6;

            doc.text(
              `   Status: ${c.status} | Berakhir: ${new Date(
                c.end_date
              ).toLocaleDateString("id-ID")}`,
              margin,
              y + 24 + descHeight
            );

            y += 38 + descHeight;

            if (y > 270) {
              doc.addPage();
              y = 20;
            }
          });

          doc.save("Laporan_Kampanye.pdf");
        });

      document
        .getElementById("btnPrintDonasi")
        .addEventListener("click", async () => {
          const res = await fetch("/api/admin/donasi");
          const donasi = await res.json();

          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          doc.setFont("courier", "bold");
          doc.setFontSize(12);
          doc.text("Laporan Data Donatur - Semuabisa.com", 14, 20);

          doc.setFont("courier", "normal");
          doc.setFontSize(11);

          let y = 35;
          const margin = 14;
          const pageWidth = doc.internal.pageSize.getWidth();
          const textWidth = pageWidth - margin * 2;

          donasi.forEach((d, i) => {
            doc.text(`${i + 1}. ${d.nama_donatur}`, margin, y);
            doc.text(
              `   Nominal: Rp ${Number(d.nominal).toLocaleString("id-ID")}`,
              margin,
              y + 8
            );

            const pesanText = `   Pesan: ${d.pesan || "-"}`;
            const wrappedPesan = doc.splitTextToSize(pesanText, textWidth);
            doc.text(wrappedPesan, margin, y + 16);
            const pesanHeight = wrappedPesan.length * 6;

            doc.text(
              `   Tanggal: ${new Date(d.tanggal).toLocaleDateString("id-ID")}`,
              margin,
              y + 16 + pesanHeight
            );

            y += 34 + pesanHeight;
            if (y > 270) {
              doc.addPage();
              y = 20;
            }
          });

          doc.save("Laporan_Donasi.pdf");
        });
        
      loadStats();
      loadCampaigns();
      loadDonasi();
      
      setInterval(() => {
        loadStats();
        loadCampaigns();
        loadDonasi();
      }, 30000);
    </script>
  </body>

  <style>
    html {
      scroll-behavior: smooth;
    }
    
    #mobileMenu {
      animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    
    @media (max-width: 640px) {
      button, 
      a, 
      input, 
      select {
        min-height: 44px;
      }
      
      table {
        font-size: 0.875rem;
      }
    }
  </style>
</html>
